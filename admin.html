<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel - LinkVerse</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .admin-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin: 20px 0; }
        .stat { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { padding: 12px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <h1>ðŸ‘‘ Admin Panel</h1>
    
    <div class="admin-stats">
        <div class="stat">
            <h3>Total Users</h3>
            <h2 id="totalUsers">0</h2>
        </div>
        <div class="stat">
            <h3>Total Clicks</h3>
            <h2 id="totalClicks">0</h2>
        </div>
        <div class="stat">
            <h3>Total Earnings</h3>
            <h2 id="totalEarnings">$0</h2>
        </div>
        <div class="stat">
            <h3>US Clicks %</h3>
            <h2 id="usPercent">0%</h2>
        </div>
    </div>
    
    <h3>All Users</h3>
    <table id="usersTable">
        <thead>
            <tr>
                <th>Email</th>
                <th>Earnings</th>
                <th>Joined</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="usersBody">
            <!-- Users will load here -->
        </tbody>
    </table>
    
    <script>
        // Check admin access
        const token = localStorage.getItem('token');
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        
        if (!token || !user.isAdmin) {
            alert('Admin access required!');
            window.location.href = '/';
        }
        
        async function loadAdminData() {
            try {
                const response = await fetch('/api/admin/users', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalUsers').textContent = data.users.length;
                    
                    // Calculate total earnings
                    const totalEarnings = data.users.reduce((sum, user) => sum + user.earnings, 0);
                    document.getElementById('totalEarnings').textContent = `$${totalEarnings.toFixed(2)}`;
                    
                    // Load users table
                    const usersBody = document.getElementById('usersBody');
                    usersBody.innerHTML = '';
                    
                    data.users.forEach(user => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${user.email}</td>
                            <td>$${user.earnings.toFixed(2)}</td>
                            <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                            <td>${user.isAdmin ? 'Admin' : 'User'}</td>
                        `;
                        usersBody.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('Error loading admin data:', error);
            }
        }
        
        window.onload = loadAdminData;
    </script>
</body>
</html>